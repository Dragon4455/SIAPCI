<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura</title>
    <link rel="stylesheet" href="styles/factura.css">
    <link rel="stylesheet" href="styles/navbar.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
</head>

<body>
    <nav class="menu__nav">
        <a href="venta.html" class="menu__link">Salir</a>
    </nav>
    <main class="bill__container">
        <h2 class="bill__title">Factura de venta</h2>
        <div class="bill__outputs" id="form">
            <div class="bill__output">
                <p>Nombre: <span id="nombCli"></span></p>
                <p></p>
            </div>
            <div class="bill__output">
                <p>Rif: <span id="rifCli"></span></p>
                <p id="rifCli"></p>
            </div>
            <div class="bill__output">
                <p>Dirección: <span id="dirCli"></span></p>
                
            </div>
            <div class="bill__output">
                <p>Teléfono: <span id="telCli" ></span></p>
                <p ></p>
            </div>
            <div class="bill__output">
                <p>Número de Factura: <span id="numFact"></span></p>
                <p ></p>
            </div>
            <div class="bill__output">
                <p>Tipo de Pago: <span id="tipPago"></span></p>
                
            </div>
            <div class="bill__output">
                <p>Condición de pago: <span id="conPago"></span></p>
                <p ></p>
            </div>
        </div>
        <div class="bill__products">
            <div class="bill__output__legend">
                <p>Cantidad:</p>
                <p>Nombre de articulo:</p>
                <p>Precio Unitario:</p>
                <p>Precio:</p>


            </div>

            <!-- <div class="bill__product">
                <p id="item__cant">1</p>
                <p id="item__name">Pega</p>
                <p id="item__name">Pega</p>
                <p id="item__price">20</p>
            </div> -->

        </div>
        <div class="bill__total">
            <p>Subtotal: <span id="subTotal"></span> Bs</p>
            <p >IVA(16%): <span id="iva"></span> Bs</p>
            <p >Total: <span id="total"> </span> Bs</p>
        </div>
    </main>

    <div id="buttons">
        <button id="print">Imprimir</button>
        <button id="edit">Editar</button>
        <button id="del">Anular</button>
    </div>
    <article>

    <article class="modalEdit">

        <div>

            <form>
                
                <label>Nombre del Cliente</label>
                <input type="text" id="Nombre">
                <br>
                <label>RIF</label>
                <input type="text" id="Rif">
                 <label>Direccion</label>
                <input type="text" id="Dir">
                 <label>Telefono</label>
                <input type="text" id="Tlf">
                 <label>Numero de Factura</label>
                <input type="text" id="Num__Fact">
                 <label>Tipo de pago</label>
                <input type="text" id="tip__P">
                 <label>Condicion de Pago</label>
                <input type="text" id="con__P">

            </form>
        
            <button id="closeEdit">Cerrar</button>
            <button id="saveEdit">Guardar</button>
        </div>
        

    </article>

    </article>
    <!-- <script src="/scripts/venta.js"></script> -->
     <script>
        window.onload = function () {
            let codigoFactura = localStorage.getItem("facturaABuscar");
            if(codigoFactura){
                const facturas = localStorage.getItem("BDFactura");
                const bdfacturas = JSON.parse(facturas);
                console.log(bdfacturas[codigoFactura]);
                let nombCli = document.querySelector("#nombCli"),
                    rifCli = document.querySelector("#rifCli"),
                    dirCli = document.querySelector("#dirCli"),
                    telCli = document.querySelector("#telCli"),
                    numFac = document.querySelector("#numFact"),
                    tipPago = document.querySelector("#tipPago"),
                    conPago = document.querySelector("#conPago")

                nombCli.textContent = bdfacturas[codigoFactura].nombre;
                rifCli.textContent = bdfacturas[codigoFactura].rif;
                dirCli.textContent =bdfacturas[codigoFactura].direccion;
               telCli.textContent = bdfacturas[codigoFactura].tlf;
               numFac.textContent = bdfacturas[codigoFactura].nroFactura;
               tipPago.textContent = bdfacturas[codigoFactura].metodo;
               conPago.textContent = bdfacturas[codigoFactura].condicion;

               let $cart = document.querySelector(".bill__products");
               cart = bdfacturas[codigoFactura].articulos;
                cart.forEach((item, index, )=>{
                
                let contenedor = document.createElement("div");
    
                contenedor.classList.add("bill__product");
                $cart.appendChild(contenedor)
                
                
                let itemCant = document.createElement("p");
                itemCant.textContent = item.cantidad;
                contenedor.appendChild(itemCant);
                
                let itemName = document.createElement("p");
                itemName.textContent = item.nombre;
                contenedor.appendChild(itemName);
               
                
                let itemUnitPrice = document.createElement("p");
                itemUnitPrice.textContent = item.precio + " Bs";
                contenedor.appendChild(itemUnitPrice);

                let itemPrice = document.createElement("p");
                itemPrice.textContent = item.precioTotal + " Bs";
                contenedor.appendChild(itemPrice);
                
                
              
            });
                let subtotal = document.querySelector("#subTotal");
                let iva = document.querySelector("#iva");
                let total = document.querySelector("#total");
                subtotal.textContent = cart.reduce((sum , actual) => sum + actual.precioTotal , 0);
                 iva.textContent = (subtotal.textContent * 0.16).toFixed(2);
                total.textContent = (+subtotal.textContent + +iva.textContent).toFixed(2);
            }else{

                const clienteActual = localStorage.getItem("cliente");
                const productos = localStorage.getItem("productos");
                const facturas = localStorage.getItem("BDFactura");
                console.log(clienteActual);
                if (clienteActual) {
                    const cliente = JSON.parse(clienteActual);
                    const cart = JSON.parse(productos);
                    const bdfacturas = JSON.parse(facturas);
    
        
                   
    
                    console.log(bdfacturas)
            
                    let nombCli = document.querySelector("#nombCli"),
                        rifCli = document.querySelector("#rifCli"),
                        dirCli = document.querySelector("#dirCli"),
                        telCli = document.querySelector("#telCli"),
                        numFac = document.querySelector("#numFact"),
                        tipPago = document.querySelector("#tipPago"),
                        conPago = document.querySelector("#conPago")
    
                    nombCli.textContent = cliente.nombre;
                    rifCli.textContent = cliente.rif;
                    dirCli.textContent = cliente.direccion;
                   telCli.textContent = cliente.tlf;
                   numFac.textContent = String(bdfacturas.length).padStart(3, '0');
                   tipPago.textContent = cliente.metodo;
                   conPago.textContent = cliente.condicion;
    
                   let $cart = document.querySelector(".bill__products");
                   console.log(cart)
                    cart.forEach((item, index, )=>{
                    
                    let contenedor = document.createElement("div");
        
                    contenedor.classList.add("bill__product");
                    $cart.appendChild(contenedor)
                    
                    
                    let itemCant = document.createElement("p");
                    itemCant.textContent = item.cantidad;
                    contenedor.appendChild(itemCant);
                    
                    let itemName = document.createElement("p");
                    itemName.textContent = item.nombre;
                    contenedor.appendChild(itemName);
                   
                    
                    let itemUnitPrice = document.createElement("p");
                    itemUnitPrice.textContent = item.precio + " Bs";
                    contenedor.appendChild(itemUnitPrice);
    
                    let itemPrice = document.createElement("p");
                    itemPrice.textContent = item.precioTotal + " Bs";
                    contenedor.appendChild(itemPrice);
                    
                    
                  
                });
                    let subtotal = document.querySelector("#subTotal");
                    let iva = document.querySelector("#iva");
                    let total = document.querySelector("#total");
                    subtotal.textContent = cart.reduce((sum , actual) => sum + actual.precioTotal , 0);
                     iva.textContent = (subtotal.textContent * 0.16).toFixed(2);
                    total.textContent = (+subtotal.textContent + +iva.textContent).toFixed(2);
                    
                }
            }

        }

        let printBtn = document.querySelector("#print");

        printBtn.addEventListener("click", (e)=>{
            window.print();
        })
    </script>

    <script src="scripts/factura.js"></script>
    <script src="scripts/anular.js"></script>
</body>

</html>