<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes</title>
    <link rel="stylesheet" href="styles/navbar.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
        rel="stylesheet">
</head>

<body>
    <h1 class="menu__title">REPORTES</h1>
    <nav class="menu__nav">
        <a href="menu.html" class="menu__link">Menu</a>
        <a href="venta.html" class="menu__link">Ventas</a>
        <a href="inventario.html" class="menu__link">Inventario</a>
        
        <a href="#" class="menu__link">Reportes</a>
        <a href="Mantenimiento.html" class="menu__link">Mantenimiento</a>
        <a href="ayuda.html" class="menu__link">Ayuda </a>
        <a href="index.html" class="menu__link">Salir</a>
    </nav>

    <div class="reportes__botones">
        <button id="ventasBtn" class="reporte-btn">Reporte de Ventas</button>
        <button id="facturasBtn" class="reporte-btn">Reporte de Facturas por cobrar</button>
        <button id="inventarioBtn" class="reporte-btn">Reporte de Inventario</button>
    </div>

    <!-- Modal Ventas -->
    <div id="ventasModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="ventasModal">&times;</span>
            <h2>Reporte de Ventas</h2>
            <div class="custom-table" id="ventasTable">
                <div class="custom-table-header">
                    <div>Fecha</div>
                    <div>Nro de Venta</div>
                    <div>Descripci贸n del Producto</div>
                    <div>Cantidad</div>
                    <div>Precio Unitario</div>
                    <div>Precio Total</div>
                    <div>Total Venta </div>
                    <div>Forma de Pago</div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Facturas -->
    <div id="facturasModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="facturasModal">&times;</span>
            <h2>Reporte de Facturas por cobrar</h2>
            <div class="custom-table" id="facturasTable">
                <div class="custom-table-header">
                    <div>No. Factura</div>
                    <div>Fecha Emisi贸n</div>
                    <div>Nombre Cliente</div>
                    <div>RIF/C.I. Cliente</div>
                    <div>Total Factura</div>
                    <div>Fecha de vencimiento</div>
                    <div>Estado</div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Inventario -->
    <div id="inventarioModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="inventarioModal">&times;</span>
            <h2>Reporte de Inventario</h2>
            <div class="custom-table" id="inventarioTable">
                <div class="custom-table-header">
                    <div>C贸digo/SKU</div>
                    <div>Nombre del Producto</div>
                    <div>Cantidad en Stock</div>
                    <div>Precio Costo Unitario</div>
                    <div>Precio Venta Unitario</div>
                    <div>Ultima Actualizaci贸n</div>
                    <div>Nivel de Reorden</div>
                </div>

            </div>
        </div>
    </div>

    <style>
        .reportes__botones {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-direction: column;
            display: flex;
            background: rgb(235, 250, 255);
            box-shadow: 0 6px 32px rgba(0, 0, 0, 0.12);
            border-radius: 16px;
            padding: 2.5rem 2rem;
            max-width: 500px;
            width: 100%;
            margin: 2rem auto;
            min-height: 30vh;


        }

        .reporte-btn {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            background: #2d6cdf;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .reporte-btn:hover {
            background: #1a4fa0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background: #fff;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 900px;
            position: relative;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.2);
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 2rem;
            color: #888;
            cursor: pointer;
        }

        .close:hover {
            color: #2d6cdf;
        }

        .custom-table {
            width: 100%;
            margin-top: 1.5rem;
        }

        .custom-table-header,
        .custom-table-row {
            display: grid;
            align-items: center;
            padding: 0.5rem 0;
        }

        /* Column templates for each table */
        #ventasModal .custom-table-header,
        #ventasModal .custom-table-row {
            grid-template-columns: repeat(8, 1fr);
        }

        #facturasModal .custom-table-header,
        #facturasModal .custom-table-row {
            grid-template-columns: repeat(7, 1fr);
        }

        #inventarioModal .custom-table-header,
        #inventarioModal .custom-table-row {
            grid-template-columns: repeat(7, 1fr);
        }

        .custom-table-header {
            font-weight: bold;
            background: #f0f4fa;
            border-bottom: 2px solid #2d6cdf;
        }

        .custom-table-row {
            border-bottom: 1px solid #e0e0e0;
        }

        .custom-table-row:last-child {
            border-bottom: none;
        }

        .custom-table-row>div,
        .custom-table-header>div {
            padding: 0.5rem;
            text-align: center;
            word-break: break-word;
        }

        @media (max-width: 700px) {
            .modal-content {
                padding: 1rem;
            }

            .custom-table-header,
            .custom-table-row {
                font-size: 0.85rem;
            }
        }
        .anulado{
            opacity: 0.6;
        }
    </style>

    <script>
        let JsonProductos = localStorage.getItem("BDProducto");
        let BDProducto = JSON.parse(JsonProductos) || [];
        let JsonPorCobrar = localStorage.getItem("BDPorCobrar");
        let BDPorCobrar = JSON.parse(JsonPorCobrar) || [];
        let JsonFacturas = localStorage.getItem("BDFactura");
        let BDFacturas = JSON.parse(JsonFacturas) || [];

        document.addEventListener('DOMContentLoaded', function () {
            const modals = {
                ventasModal: document.getElementById('ventasModal'),
                facturasModal: document.getElementById('facturasModal'),
                inventarioModal: document.getElementById('inventarioModal')
            };

            document.getElementById('ventasBtn').addEventListener('click', function () {
                generarTablaVentas();
                modals.ventasModal.style.display = 'block';
            });
            document.getElementById('facturasBtn').addEventListener('click', function () {
                generarTablaFacturas();
                modals.facturasModal.style.display = 'block';
            });
            document.getElementById('inventarioBtn').addEventListener('click', function () {
                generarTablaInventario();
                modals.inventarioModal.style.display = 'block';
            });

            document.querySelectorAll('.close').forEach(function (span) {
                span.addEventListener('click', function () {
                    const modalId = this.getAttribute('data-modal');
                    modals[modalId].style.display = 'none';
                });
            });

            window.addEventListener('click', function (event) {
                Object.values(modals).forEach(function (modal) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            function generarTablaVentas() {
                const ventasTable = document.getElementById('ventasTable');
                // Elimina filas previas
                ventasTable.querySelectorAll('.custom-table-row').forEach(row => row.remove());

                if (!Array.isArray(BDFacturas)) {
                    return;
                } else {
                    BDFacturas.forEach((factura, idx) => {
                        let totalVenta = parseFloat(factura.montoTotal) || 0;
                        factura.articulos.forEach(item => {
                            const row = document.createElement('div');
                            row.className = 'custom-table-row';
                            
                            if(factura.anulado){
                                row.style.opacity = "0.6"
                             }
                            row.innerHTML = `
                            <div>${factura.fecha || ''}</div>
                            <div>${factura.nroFactura || idx + 1}</div>
                            <div>${item.nombre || ''}</div>
                            <div>${item.cantidad || ''}</div>
                            <div>${item.precio != null ? Number(item.precio).toFixed(2) : ''}</div>
                            <div>${item.precioTotal != null ? Number(item.precioTotal).toFixed(2) : ''}</div>
                            <div>${totalVenta != null ? Number(totalVenta).toFixed(2) : ''}</div>
                            <div>${factura.metodo || ''}</div>
                        `;
                            ventasTable.appendChild(row);
                        });
                    });
                }
            }

            function generarTablaFacturas() {
                const facturasTable = document.getElementById('facturasTable');
                // Elimina filas previas
                facturasTable.querySelectorAll('.custom-table-row').forEach(row => row.remove());

                if (!Array.isArray(BDPorCobrar)) {
                    return;
                } else {
                    BDPorCobrar.forEach((factura, idx) => {
                        const row = document.createElement('div');
                        row.className = 'custom-table-row';
                        
                        row.innerHTML = `
                        <div>${factura.nroFactura || idx + 1}</div>
                        <div>${factura.fecha || ''}</div>
                        <div>${factura.nombre || ''}</div>
                        <div>${factura.rif || ''}</div>
                        <div>${factura.montoTotal != null ? Number(factura.montoTotal).toFixed(2) : ''}</div>
                        <div>${factura.vencimiento || ''}</div>
                        <div>${factura.estado || ''}</div>
                    `;
                        facturasTable.appendChild(row);
                    });
                }
            }

            function generarTablaInventario() {
                const inventarioTable = document.getElementById('inventarioTable');
                // Elimina filas previas
                inventarioTable.querySelectorAll('.custom-table-row').forEach(row => row.remove());

                if (!Array.isArray(BDProducto)) {
                    return;
                } else {
                    BDProducto.forEach(producto => {
                        const row = document.createElement('div');
                        row.className = 'custom-table-row';
                        row.innerHTML = `
                        <div>${producto.codigo || ''}</div>
                        <div>${producto.nombre || ''}</div>
                        <div>${producto.disponible || ''}</div>
                        <div>${producto.costo != null ? Number(producto.costo).toFixed(2) : ''}</div>
                        <div>${producto.precio != null ? Number(producto.precio).toFixed(2) : ''}</div>
                        <div>${producto.ultimaActualizacion || ''}</div>
                        <div>${producto.nivelReorden != null ? producto.nivelReorden : ''}</div>
                    `;
                        inventarioTable.appendChild(row);
                    });
                }
            }
        });
    </script>
    </script>
</body>